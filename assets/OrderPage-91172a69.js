import{m as P,D as x,P as D}from"./PaginationComp-544a77a3.js";import{_ as O,o as l,c as d,a as t,t as o,g as M,F as u,i as y,h as $,j as k,r as b,b as g}from"./index-24ff0da9.js";const E={mixins:[P],props:["order"],data(){return{tempOrder:{}}},watch:{order(){this.tempOrder=this.order}}},Y={id:"productModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},V={class:"modal-dialog modal-xl"},B={class:"modal-content border-0"},L=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{id:"productModalLabel",class:"modal-title"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),U={class:"modal-body"},N={class:"row"},S={class:"col-sm-4"},T=t("h3",null,"用戶資料",-1),j={class:"table"},q={key:0},F=t("th",{scope:"row"},"姓名",-1),z={class:"align-baseline"},A=t("th",{scope:"row"},"Email",-1),G={class:"align-baseline"},H=t("th",{scope:"row"},"電話",-1),I={class:"align-baseline"},J=t("th",{scope:"row"},"地址",-1),K={class:"align-baseline"},Q={class:"col-sm-8"},R=t("h3",null,"訂單細節",-1),W={class:"table"},X=t("th",{scope:"row"},"訂單編號",-1),Z={class:"align-baseline"},tt=t("th",{scope:"row"},"下單時間",-1),et={class:"align-baseline"},st=t("th",{scope:"row"},"付款狀態",-1),ot={key:0,class:"text-success align-baseline"},nt={key:1,class:"text-secondary align-baseline"},lt=t("th",{scope:"row"},"總金額",-1),dt={class:"align-baseline"},it=t("h3",null,"選購商品",-1),at={class:"table"},rt={scope:"row"},ct={class:"text-end"},ht={class:"d-flex justify-content-end"},_t={class:"form-check"},pt={class:"form-check-label",for:"isPaid"},ut={key:0},mt={key:1},bt={class:"modal-footer"},gt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ft(s,n,i,_,e,h){return l(),d("div",Y,[t("div",V,[t("div",B,[L,t("div",U,[t("div",N,[t("div",S,[T,t("table",j,[e.tempOrder.user?(l(),d("tbody",q,[t("tr",null,[F,t("td",z,o(e.tempOrder.user.name),1)]),t("tr",null,[A,t("td",G,o(e.tempOrder.user.email),1)]),t("tr",null,[H,t("td",I,o(e.tempOrder.user.tel),1)]),t("tr",null,[J,t("td",K,o(e.tempOrder.user.address),1)])])):M("",!0)])]),t("div",Q,[R,t("table",W,[t("tbody",null,[t("tr",null,[X,t("td",Z,o(e.tempOrder.id),1)]),t("tr",null,[tt,t("td",et,o(this.$moment(e.tempOrder.create_at*1e3).format("YYYY/MM/DD")),1)]),t("tr",null,[st,e.tempOrder.is_paid?(l(),d("td",ot," 已付款 ")):(l(),d("td",nt,"未付款"))]),t("tr",null,[lt,t("td",dt,o(e.tempOrder.total),1)])])]),it,t("table",at,[t("tbody",null,[(l(!0),d(u,null,y(i.order.products,(r,m)=>(l(),d("tr",{key:m},[t("th",rt,o(r.product.title),1),t("td",null,o(r.qty)+"/"+o(r.product.unit),1),t("td",ct,o(r.total),1)]))),128))])]),t("div",ht,[t("div",_t,[$(t("input",{class:"form-check-input",type:"checkbox",id:"isPaid","onUpdate:modelValue":n[0]||(n[0]=r=>e.tempOrder.is_paid=r)},null,512),[[k,e.tempOrder.is_paid]]),t("label",pt,[e.tempOrder.is_paid?(l(),d("span",ut,"已付款")):(l(),d("span",mt,"未付款"))])])])])])]),t("div",bt,[gt,t("button",{type:"button",class:"btn btn-primary",onClick:n[1]||(n[1]=r=>s.$emit("updatePaid",e.tempOrder))}," 修改付款狀態 ")])])])],512)}const yt=O(E,[["render",ft]]),f="hironakavue";let p=null;const Ot={data(){return{orders:[],tempOrder:{},pages:{}}},components:{OrderModal:yt,DelModal:x,Pagination:D},methods:{getOrders(s=1){const n=this.$loading.show();this.$http.get(`/api/${f}/admin/orders?page=${s}`).then(i=>{const{orders:_,pagination:e}=i.data;this.orders=_,this.pages=e}).then(()=>{p.fire({icon:"success",title:"訂單載入成功"})}).catch(i=>{this.handleError(i)}).finally(()=>{n.hide()})},openModal(s){const n=this.$loading.show();this.tempOrder={...s},this.$refs.orderModal.openModal(),n.hide()},openDelModal(s){const n=this.$loading.show();this.tempProduct={...s},this.$refs.delModal.openModal(),n.hide()},updatePaid(s){const n=`/api/${f}/admin/order/${s.id}`,i={data:{is_paid:s.is_paid}},_=this.$refs.orderModal;this.$http.put(n,i).then(e=>{_.hideModal(),p.fire({icon:"success",title:`${e.data.message}`}).then(()=>{this.getOrders()})}).catch(e=>{_.hideModal(),this.handleError(e)}).then(()=>{this.getOrders()})},delOrder(s){const n=this.$refs.delModal;this.$http.delete(`/api/${f}/admin/order/${s.id}`).then(i=>{p.fire({icon:"success",title:`${i.data.message}`}),n.hideModal(),this.getOrders()}).catch(i=>{n.hideModal(),this.handleError(i),this.getOrders()})},handleError(s){p.fire({icon:"error",title:`${s.response.data.message}`})}},mounted(){p=this.$swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:s=>{s.addEventListener("mouseenter",this.$swal.stopTimer),s.addEventListener("mouseleave",this.$swal.resumeTimer)}}),this.getOrders()}},Mt={class:"container-fluid"},$t={class:"table mt-4"},kt=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),vt={key:0},wt={class:"list-group list-group-flush"},Ct={class:"text-right"},Pt={class:"form-check form-switch"},xt=["id","onUpdate:modelValue","onChange"],Dt=["for"],Et={key:0},Yt={key:1},Vt={class:"btn-group"},Bt=["onClick"],Lt=["onClick"];function Ut(s,n,i,_,e,h){const r=b("Pagination"),m=b("OrderModal"),v=b("DelModal");return l(),d("div",Mt,[t("table",$t,[kt,t("tbody",null,[(l(!0),d(u,null,y(e.orders,(a,w)=>(l(),d(u,{key:w},[e.orders.length?(l(),d("tr",vt,[t("td",null,o(this.$moment(a.create_at*1e3).format("YYYY/MM/DD")),1),t("td",null,o(a.user.email),1),t("td",null,[t("ul",wt,[(l(!0),d(u,null,y(a.products,(c,C)=>(l(),d("li",{key:C,class:"list-group-item px-0"},o(c.product.title)+" 數量："+o(c.qty)+" "+o(c.product.unit),1))),128))])]),t("td",Ct,o(a.total),1),t("td",null,[t("div",Pt,[$(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:`paidSwitch${a.id}`,"onUpdate:modelValue":c=>a.is_paid=c,onChange:c=>h.updatePaid(a)},null,40,xt),[[k,a.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${a.id}`},[a.is_paid?(l(),d("span",Et,"已付款")):(l(),d("span",Yt,"未付款"))],8,Dt)])]),t("td",null,[t("div",Vt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:c=>h.openModal(a)}," 檢視 ",8,Bt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:c=>h.openDelModal(a)}," 刪除 ",8,Lt)])])])):M("",!0)],64))),128))])]),g(r,{pages:e.pages,onChangePage:h.getOrders},null,8,["pages","onChangePage"]),g(m,{order:e.tempOrder,onUpdatePaid:h.updatePaid,ref:"orderModal"},null,8,["order","onUpdatePaid"]),g(v,{product:s.tempProduct,onDel:h.delOrder,ref:"delModal"},null,8,["product","onDel"])])}const Tt=O(Ot,[["render",Ut]]);export{Tt as default};
